{#
  Copyright (c) Ansible Project
  GNU General Public License v3.0+ (see LICENSES/GPL-3.0-or-later.txt or https://www.gnu.org/licenses/gpl-3.0.txt)
  SPDX-License-Identifier: GPL-3.0-or-later
#}

{% from 'macros/deprecates.rst.j2' import collection_deprecation_marker with context -%}
{% from 'macros/deprecates.rst.j2' import deprecation_marker with context -%}

:orphan:

{% if antsibull_docs_version %}
.. meta::
  :antsibull-docs: @{ antsibull_docs_version }@

{% endif %}
.. _list_of_all_deprecations:

{% if deprecated_collection_infos and deprecated_plugin_info %}
Index of all deprecated collections and plugins
===============================================
{% elif deprecated_collection_infos %}
Index of all deprecated collections
===================================
{% else %}
Index of all deprecated plugins
===============================
{% endif %}

{% if deprecated_collection_infos %}
Index of all deprecated collections
-----------------------------------

{%   for collection_name, collection_meta in deprecated_collection_infos.items() | sort %}
* :anscollection:`@{ collection_name }@ <@{collection_name}@>`
{%     if for_official_docsite and collection_meta.deprecation_info %}
  will be removed from Ansible @{ collection_meta.removal_ansible_major_version }@
{%     endif %}
{%   endfor %}

{% endif %}
{% for plugin_type, plugins in deprecated_plugin_info.items() | sort %}
{%   if plugin_type == 'module' %}
Index of all deprecated modules
-------------------------------
{%   elif plugin_type == 'role' %}
Index of all deprecated roles
-----------------------------
{%   else %}
Index of all deprecated @{ plugin_type }@ plugins
------------------------@{ '-' * (plugin_type | column_width) }@--------
{%   endif %}

{%   for plugin_fqcn, plugin_info in plugins.items() | sort %}
* :ansplugin:`@{ plugin_fqcn }@#@{ plugin_type }@` -- @{ plugin_info.short_description | rst_ify(plugin_fqcn=plugin_fqcn, plugin_type=plugin_type) }@
{%     if plugin_info.deprecation %}
  (Will be removed from :anscollection:`@{ plugin_fqcn.split(".")[:2] | join(".") }@`
{%       if plugin_info.deprecation.removed_in %}
  @{ plugin_info.deprecation.removed_in }@.)
{%       elif plugin_info.deprecation.removed_at_date %}
  in a major release after @{ plugin_info.deprecation.removed_at_date }@.)
{%       endif %}
{%     endif %}
{%   endfor %}

{% endfor %}
{% if not deprecated_collection_infos and not deprecated_plugin_info %}
No plugins have been deprecated.
{% endif %}
